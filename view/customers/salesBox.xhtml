<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:app="http://encens.com/products/khipus/facelets"
                template="/layout/template.xhtml">


<ui:define name="pageTitle">#{messages['Sales.title']}</ui:define>

<ui:param name="bodyAlign" value="center"/>
<ui:param name="bodyWidth" value="100%"/>
    productInventoryList
<ui:param name="selectedTab" value="customers"/>
<ui:define name="body">


<h:form id="salesForm">

    <rich:panel id="salesPanel">
    <f:facet name="header">V e n t a s</f:facet>
        <h:panelGrid columns="3" border="0" width="100%" styleClass="left">
            <s:div id="part1">

                <s:decorate id="productField" template="/include/inputField.xhtml" styleClass="formRow,left">
                    <app:suggestionBox id="productSuggestionBox"
                                       value="#{salesAction.productItemFullName}"
                                       entity="#{salesAction.productItem}"
                                       styleClass="input250"
                                       entityAlias="productItem"
                                       searchField="name"
                                       searchCompoundFields="productItem.productItemCode,productItem.name"
                                       updateFocusOnSelect="true">
                        <ui:define name="columns">
                            <h:column>
                                <h:outputText value="#{entityItem.fullName2}" />
                            </h:column>
                        </ui:define>
                    </app:suggestionBox>

                    <a4j:commandButton action="#{salesAction.addProduct()}"
                                       value="Agregar Producto" styleClass="button"
                                       reRender="productDataTable, productField" />
                </s:decorate>
                <!--<s:decorate id="productInventoryField" template="/include/inputField.xhtml" styleClass="formRow">
                    <ui:define name="label">
                        <h:outputText value="Productos"/>
                    </ui:define>
                    <app:suggestionBox id="productInventorySuggestionBox"
                                       value="#{productInventoryAction.productItemFullname}"
                                       entity="#{productInventory.productItem}"
                                       styleClass="inputLarge"
                                       entityAlias="productItem"
                                       searchField="fullName2"
                                       searchCompoundFields="productItem.productItemCode,productItem.name"
                                       searchCompoundCondition="concat(concat(productItem.productItemCode,' - '),productItem.name)"
                                       updateFocusOnSelect="true">
                        <ui:define name="columns">
                            <h:column>
                                <h:outputText value="#{entityItem.fullName}" />
                            </h:column>
                        </ui:define>
                    </app:suggestionBox>
                    <a4j:commandButton action="#{productInventoryAction.updateStock}"
                                       value="Agregar"
                                       styleClass="button"
                                       reRender="updateStockForm"/>
                </s:decorate>-->
            </s:div>

            <s:div id="part2">
                <s:decorate id="dateField" template="/include/inputField.xhtml" styleClass="formRow">
                    <rich:calendar value="#{voucherCreateAction.voucher.date}"
                                   popup="true"
                                   datePattern="#{messages['patterns.date']}"
                                   inputClass="inputSmall"
                                   enableManualInput="true"
                                   tabindex="1"
                                   required="false">
                        <f:convertDateTime pattern="#{messages['patterns.date']}" timeZone="#{sessionUser.timeZone}" type="date"/>
                    </rich:calendar>
                </s:decorate>
            </s:div>

            <s:div id="part3">

                <s:decorate id="saleTypeField" template="/include/inputField.xhtml" styleClass="formRow">
                    <!--<ui:define name="label">#{messages['Sales.cash']}</ui:define>-->
                    <h:outputText>#{messages['Sales.cash']}</h:outputText>
                    <h:selectBooleanCheckbox id="cashSaleCheck" value="#{salesAction.cashSaleCheck}"
                                             tabindex="16">
                        <!--<a4j:support event="onchange" action="#{creditTransactionAction.clearPartnerAccount()}"
                                     reRender="transferSavingField, savingAccountDiv, capitalField" ajaxSingle="true"/>-->
                    </h:selectBooleanCheckbox>
                    <h:outputText>#{messages['Sales.credit']}</h:outputText>
                    <h:selectBooleanCheckbox id="creditSaleCheck" value="#{salesAction.creditSaleCheck}"
                                             tabindex="16">
                        <!--<a4j:support event="onchange" action="#{creditTransactionAction.clearPartnerAccount()}"
                                     reRender="transferSavingField, savingAccountDiv, capitalField" ajaxSingle="true"/>-->
                    </h:selectBooleanCheckbox>
                </s:decorate>

            </s:div>

        </h:panelGrid>

        <h:panelGrid columns="2" cellpadding="0" cellspacing="0"  border="0" width="100%" columnClasses="width10percent,width90percent">

            <s:div>
                <h:selectOneMenu>
                    <f:selectItem itemValue="0" itemLabel="Normal" />
                    <f:selectItem itemValue="1" itemLabel="Degustacion" />
                    <f:selectItem itemValue="2" itemLabel="Refrigerio" />
                    <f:selectItem itemValue="3" itemLabel="Descontar Productores" />
                    <f:selectItem itemValue="4" itemLabel="Descontar Veterinarios " />
                </h:selectOneMenu>
            </s:div>
            <s:div>
                <c:forEach items="#{salesAction.bestProductList}" var="productItem">
                    <!--<h:commandButton value="#{productItem.acronym}" styleClass="button" />-->
                    <a4j:commandButton action="#{salesAction.addProduct(productItem)}"
                                       value="#{productItem.acronym}" styleClass="button"
                                       reRender="productDataTable" />

                </c:forEach>
            </s:div>

        </h:panelGrid>

    </rich:panel>

    <h:panelGrid columns="3" cellpadding="0" cellspacing="0" border="0"
                 width="100%" columnClasses="width33percent,width33percent,width33percent">

        <s:div>
            <s:decorate id="clientField" template="/include/inputField.xhtml" styleClass="formRow">
                <ui:define name="label">#{messages['Client.client']}</ui:define>
                <!--<h:outputText value="#{messages['Client.client']}" />-->
                <!--<rich:spacer width="5px" />-->
                <app:selectPopUp id="clientFieldId"
                                 required="false"
                                 textValue="#{voucherCreateAction.client.fullName}"
                                 value="#{voucherCreateAction.client}"
                                 clearAction="voucherCreateAction.clearClient()"
                                 searchModalPanel="clientListModalPanel"
                                 dataModel="#{clientDataModel}"
                                 reRender="clientField"
                                 tabindex="12">
                </app:selectPopUp>
            </s:decorate>
        </s:div>
        <s:div styleClass="right">
            <s:decorate template="/include/inputField.xhtml" styleClass="formRow">
                <h:outputText value="Total:" styleClass="text12" />
                <h:outputText id="totalAmount" value="#{salesAction.totalAmount}" styleClass="textBold12Blue" >
                    <app:realNumberConverter pattern="#{messages['patterns.decimalNumber']}"/>
                </h:outputText>
            </s:decorate>
        </s:div>

        <s:div styleClass="buttonsRight">
            <a4j:commandButton id="addProductItemCommandButton"
                               action="#{provideSearchDataModel.reset()}"
                               value="Registrar venta"
                               styleClass="button"
                               immediate="true"
                               oncomplete="Richfaces.showModalPanel('confirmSalesModalPanelModalPanel');"
                               actionListener="#{selectPopUpAction.select}"
                               reRender="confirmSalesModalPanelModalPanel">
                <f:attribute name="entityManagerName" value=""/>
                <f:attribute name="dataModelObject" value="#{provideSearchDataModel}"/>
                <app:criteriaValue fieldName="providerCode"
                                   value="#{warehousePurchaseOrderAction.purchaseOrder.provider.id.providerCode}"/>
            </a4j:commandButton>

            <a4j:commandButton id="chargeButtonId" value="Cobrar"

                               styleClass="button"
                               tabindex="6">
                <s:defaultAction/>
            </a4j:commandButton>
            <a4j:commandButton id="registerButtonId" value="Registrar"
                               styleClass="button"
                               tabindex="6">
                <s:defaultAction/>
            </a4j:commandButton>
        </s:div>
    </h:panelGrid>

    <rich:panel id="panelProdutcs">

        <rich:dataTable id="productDataTable" value="#{salesAction.articleOrderList}"  var="articleItem" rowKeyVar="row"
                        width="100%" columnsWidth="5%, 30%, 10%, 10%, 10%, 10%, 10%, 10%, 5%">
            <f:facet name="header">
                <rich:columnGroup>
                    <rich:column>Cod</rich:column>
                    <rich:column>Descripción</rich:column>
                    <rich:column>Precio</rich:column>
                    <rich:column>Cantidad</rich:column>
                    <rich:column>Importe</rich:column>
                    <rich:column>Promo</rich:column>
                    <rich:column>Repos</rich:column>
                    <rich:column>Existencia</rich:column>
                    <rich:column>Acción</rich:column>
                </rich:columnGroup>
            </f:facet>

            <c:set var="codeFieldId" value="codeField_#{row}"/>
            <c:set var="priceFieldId" value="priceField_#{row}"/>
            <c:set var="quantityFieldId" value="quantityField_#{row}"/>
            <c:set var="amountFieldId" value="amountField_#{row}"/>
            <!--<c:set var="FieldId" value="Field_#{row}"/>-->

            <rich:column styleClass="center">
                <h:outputText value="#{articleItem.codArt}"/>
            </rich:column>

            <rich:column>
                <h:outputText value="#{articleItem.productItem.name}"/>
            </rich:column>

            <rich:column styleClass="center">
                <h:outputText value="#{articleItem.price}">
                    <app:realNumberConverter pattern="#{messages['patterns.decimalNumber']}"/>
                </h:outputText>
            </rich:column>

            <rich:column styleClass="center">
                <h:inputText id="#{quantityFieldId}" value="#{articleItem.quantity}" styleClass="inputSmall" >
                    <a4j:support event="onblur" ajaxSingle="true"
                                 reRender="productDataTable,#{amountFieldId},totalAmount"
                                 actionListener="#{salesAction.calculateAmount(articleItem)}"/>
                </h:inputText>
            </rich:column>

            <rich:column styleClass="center">
                <h:outputText id="#{amountFieldId}" value="#{articleItem.amount}">
                    <app:realNumberConverter pattern="#{messages['patterns.decimalNumber']}"/>
                </h:outputText>
            </rich:column>

            <rich:column styleClass="center">
                <h:inputText value="#{articleItem.promotion}" styleClass="inputTiny"/>
            </rich:column>

            <rich:column styleClass="center">
                <h:inputText value="#{articleItem.reposicion}" styleClass="inputTiny"/>
            </rich:column>

            <rich:column></rich:column>
            <rich:column styleClass="center">
                <s:div id="removeProductId">
                    <a4j:commandLink ajaxSingle="true"
                                     immediate="true"
                                     title="#{messages['Common.remove']}"
                                     action="#{salesAction.removeProduct(articleItem)}"
                                     reRender="productDataTable,totalAmount">
                        <h:graphicImage value="/img/clear.jpg" styleClass="select-image-middle"/>
                    </a4j:commandLink>
                </s:div>
            </rich:column>

        </rich:dataTable>
    </rich:panel>

<div class="buttons"></div>
</h:form>

    <s:div id="clientListModalPanelDiv">
        <s:decorate id="clientListModalPanelContainer" template="/finances/clientListModalPanel.xhtml">
            <ui:param name="containerId" value="clientListModalPanelContainer"/>
            <ui:param name="dialogId" value="clientListModalPanel"/>
            <ui:define name="assignButton">
                <a4j:commandButton id="assignButton"
                                   action="#{voucherCreateAction.setClient(clientItem)}"
                                   image="/img/active.gif"
                                   styleClass="select-image-middle"
                                   reRender="clientField"
                                   oncomplete="Richfaces.hideModalPanel('clientListModalPanel');"/>
            </ui:define>
        </s:decorate>
    </s:div>

    <s:decorate id="confirmSalesModalPanelModalPanelContainer" template="/customers/confirmSalesModalPanel.xhtml">
        <ui:param name="containerId" value="confirmSalesModalPanelModalPanelContainer"/>
        <ui:param name="dialogId" value="confirmSalesModalPanelModalPanel"/>
        <ui:define name="addButton">
            <a4j:commandButton id="addButton"
                               immediate="true"
                               ajaxSingle="true"
                               action="#{salesAction.registerSale()}"
                               value="#{messages['Sales.charge']}"
                               reRender="salesPanel"
                               styleClass="button"
                               oncomplete="Richfaces.hideModalPanel('confirmSalesModalPanelModalPanel');"/>
        </ui:define>
    </s:decorate>

<!---->


<!--Set selector Id to enable focus-->
<rich:jQuery selector="#documentTypeSearch" query="focus()" timing="onload"/>
</ui:define>
</ui:composition>
