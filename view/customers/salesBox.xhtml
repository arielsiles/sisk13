<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:app="http://encens.com/products/khipus/facelets"
                template="/layout/template.xhtml">


<ui:define name="pageTitle">#{messages['Sales.title']}</ui:define>

<ui:param name="bodyAlign" value="center"/>
<ui:param name="bodyWidth" value="100%"/>
<ui:param name="selectedTab" value="customers"/>
<ui:define name="body">


<h:form id="salesForm">

    <rich:panel id="salesPanel">
    <f:facet name="header">V e n t a s</f:facet>
        <h:panelGrid columns="3" border="0" width="100%" columnClasses="width40percent,width30percent,width30percent">
            <s:div id="part1">
                <s:decorate id="productField" template="/include/inputField.xhtml" styleClass="formRow,left">
                    <app:suggestionBox id="productSuggestionBox"
                                       value="#{salesAction.productItemFullName}"
                                       entity="#{salesAction.productItem}"
                                       styleClass="input250"
                                       entityAlias="productItem"
                                       searchField="name"
                                       searchCompoundFields="productItem.productItemCode,productItem.name"
                                       updateFocusOnSelect="true">
                        <ui:define name="columns">
                            <h:column>
                                <h:outputText value="#{entityItem.fullName2}" />
                            </h:column>
                        </ui:define>
                        <ui:define name="restrictions">
                            <app:restriction condition="productItem.saleable = #{true}"/>
                        </ui:define>
                    </app:suggestionBox>

                    <a4j:commandButton action="#{salesAction.addProduct()}"
                                       value="Agregar" styleClass="button"
                                       reRender="productDataTable, productField" />
                </s:decorate>
            </s:div>

            <s:div id="part2">
                <!--<s:decorate id="dateField" template="/include/inputField.xhtml" styleClass="formRow">-->
                <!--<div class="margin-t2">-->
                    <!--<s:decorate id="orderDateField" template="/include/inputField.xhtml" styleClass="formRow">-->
                    <rich:calendar id="orderDate" value="#{salesAction.orderDate}"
                                   popup="true"
                                   datePattern="#{messages['patterns.date']}"
                                   enableManualInput="true"
                                   inputClass="input80"
                                   tabindex="100"
                                   ajaxSingle="true"
                                   required="false">
                        <a4j:support event="onchanged" reRender="orderDate"/>
                        <a4j:support event="oninputchange" reRender="orderDate"/>
                    </rich:calendar>
                    <!--</s:decorate>-->
                <!--</div>-->
                <!--</s:decorate>-->
            </s:div>

            <s:div id="part3">
                <s:div id="clientField" styleClass="buttonsLeft">
                    <h:outputText value="#{messages['Client.client']}" styleClass="text09" />
                    <rich:spacer width="5px" />
                    <app:selectPopUp id="clientFieldId"
                                     required="false"
                                     textValue="#{salesAction.client.fullName}"
                                     value="#{salesAction.client}"
                                     clearAction="#{salesAction.clearClient()}"
                                     searchModalPanel="clientListModalPanel"
                                     dataModel="#{clientDataModel}"
                                     reRender="clientField"
                                     tabindex="12">
                    </app:selectPopUp>
                </s:div>
            </s:div>

        </h:panelGrid>

        <h:panelGrid columns="2" cellpadding="0" cellspacing="0"  border="0" width="100%" columnClasses="width10percent,width90percent">

            <s:div id="customerOrderTypeField">
                <h:selectOneMenu id="customerOrderType"
                                 value="#{salesAction.customerOrderType}"
                                 styleClass="inputMedium"
                                 immediate="true"
                                 tabindex="10">
                    <s:selectItems value="#{customerOrderTypeList}" var="customerOrderType"
                                   label="#{messages[customerOrderType.type.resourceKey]}"
                                   noSelectionLabel=""
                                   hideNoSelectionLabel="false"/>
                    <s:convertEntity/>
                    <a4j:support event="onchange" ajaxSingle="true" reRender="customerOrderType"/>
                </h:selectOneMenu>

                <!--</s:decorate>-->
            </s:div>
            <s:div>
                <c:forEach items="#{salesAction.bestProductList}" var="productItem">
                    <a4j:commandButton action="#{salesAction.addProduct(productItem)}"
                                       value="#{productItem.acronym}" styleClass="button"
                                       reRender="productDataTable" />

                </c:forEach>
            </s:div>

        </h:panelGrid>

    </rich:panel>

    <h:panelGrid columns="3" cellpadding="0" cellspacing="0" border="0" width="100%" columnClasses="width33percent,width33percent,width33percent">
        <!--<s:div id="clientField" styleClass="buttonsLeft">
            <h:outputText value="#{messages['Client.client']}" styleClass="text09" />
                <rich:spacer width="5px" />
                <app:selectPopUp id="clientFieldId"
                                 required="false"
                                 textValue="#{salesAction.client.fullName}"
                                 value="#{salesAction.client}"
                                 clearAction="#{salesAction.clearClient()}"
                                 searchModalPanel="clientListModalPanel"
                                 dataModel="#{clientDataModel}"
                                 reRender="clientField"
                                 tabindex="12">
                </app:selectPopUp>
        </s:div>-->
        <s:div id="totalAmountField">
            <!--<s:decorate template="/include/inputField.xhtml" styleClass="formRow">-->
                <h:outputText value="Total:" styleClass="text10" />
                <h:outputText id="totalAmount" value="#{salesAction.calculateTotalAmount()}" styleClass="textBold12Blue" >
                    <app:realNumberConverter pattern="#{messages['patterns.decimalNumber']}"/>
                </h:outputText>
            <!--</s:decorate>-->
        </s:div>

        <s:div styleClass="buttonsRight">
            <h:commandButton id="generateReportButtonId"
                             action="#{saleReportAction.generateReport()}"
                             value="#{messages['SaleStatus.printSale']}"
                             styleClass="button"
                             immediate="true"/>

            <a4j:commandButton id="creditSaleCommandButton"
                               action="#{salesAction.initCreditSale()}"
                               value="Registrar venta"
                               styleClass="button"
                               immediate="true"
                               oncomplete="Richfaces.showModalPanel('confirmCreditSaleModalPanel');"
                               reRender="productDataTable,confirmCreditSaleModalPanel">
            </a4j:commandButton>

            <a4j:commandButton id="cashSaleCommandButton"
                               action="#{salesAction.initCashSale}"
                               value="Cobrar venta"
                               styleClass="button"
                               immediate="true"
                               oncomplete="Richfaces.showModalPanel('confirmCashSaleModalPanel');"
                               reRender="productDataTable,confirmCashSaleModalPanel">
            </a4j:commandButton>

        </s:div>
    </h:panelGrid>

    <!--<rich:panel id="panelProdutcs">-->

        <rich:dataTable id="productDataTable" value="#{salesAction.articleOrderList}"  var="articleItem" rowKeyVar="row"
                        width="100%" columnsWidth="5%, 30%, 10%, 10%, 10%, 10%, 10%, 10%, 5%">
            <f:facet name="header">
                <rich:columnGroup>
                    <rich:column>Cod</rich:column>
                    <rich:column>Descripción</rich:column>
                    <rich:column>Precio</rich:column>
                    <rich:column>Cantidad</rich:column>
                    <rich:column>Importe</rich:column>
                    <rich:column>Promo</rich:column>
                    <rich:column>Repos</rich:column>
                    <rich:column>Existencia</rich:column>
                    <rich:column>Acción</rich:column>
                </rich:columnGroup>
            </f:facet>

            <c:set var="codeFieldId" value="codeField_#{row}"/>
            <c:set var="priceFieldId" value="priceField_#{row}"/>
            <c:set var="quantityFieldId" value="quantityField_#{row}"/>
            <c:set var="amountFieldId" value="amountField_#{row}"/>
            <!--<c:set var="FieldId" value="Field_#{row}"/>-->

            <rich:column styleClass="center">
                <h:outputText value="#{articleItem.codArt}"/>
            </rich:column>

            <rich:column>
                <h:outputText value="#{articleItem.productItem.name}"/>
            </rich:column>

            <rich:column styleClass="center">
                <h:outputText value="#{articleItem.price}">
                    <app:realNumberConverter pattern="#{messages['patterns.decimalNumber']}"/>
                </h:outputText>
            </rich:column>

            <rich:column styleClass="center">
                <h:inputText id="#{quantityFieldId}" value="#{articleItem.quantity}" styleClass="inputSmall" >
                    <a4j:support event="onblur" ajaxSingle="true"
                                 reRender="productDataTable,#{amountFieldId},totalAmount"
                                 actionListener="#{salesAction.calculateAmount(articleItem)}"/>
                </h:inputText>
            </rich:column>

            <rich:column styleClass="center">
                <h:outputText id="#{amountFieldId}" value="#{articleItem.amount}">
                    <app:realNumberConverter pattern="#{messages['patterns.decimalNumber']}"/>
                </h:outputText>
            </rich:column>

            <rich:column styleClass="center">
                <h:inputText value="#{articleItem.promotion}" styleClass="inputTiny"/>
            </rich:column>

            <rich:column styleClass="center">
                <h:inputText value="#{articleItem.reposicion}" styleClass="inputTiny"/>
            </rich:column>

            <rich:column></rich:column>
            <rich:column styleClass="center">
                <s:div id="removeProductId">
                    <a4j:commandLink ajaxSingle="true"
                                     immediate="true"
                                     title="#{messages['Common.remove']}"
                                     action="#{salesAction.removeProduct(articleItem)}"
                                     reRender="productDataTable,totalAmount">
                        <h:graphicImage value="/img/clear.jpg" styleClass="select-image-middle"/>
                    </a4j:commandLink>
                </s:div>
            </rich:column>

        </rich:dataTable>
    <!--</rich:panel>-->

<div class="buttons"></div>
</h:form>

    <s:div id="clientListModalPanelDiv">
        <s:decorate id="clientListModalPanelContainer" template="/finances/clientListModalPanel.xhtml">
            <ui:param name="containerId" value="clientListModalPanelContainer"/>
            <ui:param name="dialogId" value="clientListModalPanel"/>
            <ui:define name="assignButton">
                <a4j:commandButton id="assignButton"
                                   action="#{salesAction.assignClient(clientItem)}"
                                   image="/img/active.gif"
                                   styleClass="select-image-middle"
                                   reRender="clientField"
                                   oncomplete="Richfaces.hideModalPanel('clientListModalPanel');"/>
            </ui:define>
        </s:decorate>
    </s:div>

    <s:decorate id="confirmCreditSaleModalPanelContainer" template="/customers/confirmCreditSaleModalPanel.xhtml">
        <ui:param name="containerId" value="confirmCreditSaleModalPanelContainer"/>
        <ui:param name="dialogId" value="confirmCreditSaleModalPanel"/>
    </s:decorate>

    <s:decorate id="confirmCashSaleModalPanelContainer" template="/customers/confirmCashSaleModalPanel.xhtml">
        <ui:param name="containerId" value="confirmCashSaleModalPanelContainer"/>
        <ui:param name="dialogId" value="confirmCashSaleModalPanel"/>
    </s:decorate>


<!--Set selector Id to enable focus-->
<rich:jQuery selector="#documentTypeSearch" query="focus()" timing="onload"/>
</ui:define>
</ui:composition>
